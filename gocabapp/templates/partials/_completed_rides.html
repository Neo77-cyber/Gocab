{% for ride in completed_rides %}
<div class="trip-card completed">
    <div class="trip-header">
        <span class="trip-date">{{ ride.completed_at|date:"M d, Y H:i" }}</span>
        <span class="payment-status {% if ride.payment_status == 'paid' %}paid{% else %}pending{% endif %}">
            {% if ride.payment_status == 'paid' %}
                ✅ Paid
            {% else %}
                ⏳ Waiting Payment
            {% endif %}
        </span>
    </div>
    <div class="trip-route">
        <div class="route-point pickup">
            <i class="fas fa-map-marker-alt"></i>
            <span>{{ ride.current_location }}</span>
        </div>
        <div class="route-point dropoff">
            <i class="fas fa-flag-checkered"></i>
            <span>{{ ride.destination }}</span>
        </div>
    </div>
    <div class="trip-footer">
        <span class="fare">₦{{ ride.total_fare|floatformat:2 }}</span>
        <span class="duration">{{ ride.duration_min }} mins</span>
        
        {% if ride.payment_status == 'paid' %}
        <div class="payment-details">
            <i class="fas fa-check-circle"></i>
            <span class="earnings">Earned: ₦{{ ride.driver_earnings|floatformat:2 }}</span>
        </div>
        <div class="payment-actions">
            <a href="mailto:support@gocabservices.auto?subject=Payment Request - Ride #{{ ride.id }}&body=Hello, I would like to request payment for Ride #{{ ride.id }}. Driver: {{ request.user.get_full_name }}. Total Fare: ₦{{ ride.total_fare|floatformat:2 }}. Driver Earnings: ₦{{ ride.driver_earnings|floatformat:2 }}" 
               class="btn-request-payment">
                <i class="fas fa-paper-plane"></i>
                Request Payment
            </a>
        </div>
        {% endif %}
        
    </div>
</div>
{% empty %}
<div class="no-trips">No completed trips yet</div>
{% endfor %}

{% if completed_rides.has_other_pages %}
<div class="pagination" id="completedRidesPagination">
    {% if completed_rides.has_previous %}
        <button class="page-link" data-page="{{ completed_rides.previous_page_number }}" data-action="completed">
            <i class="fas fa-chevron-left"></i> Previous
        </button>
    {% endif %}
    
    <div class="page-numbers">
        {% for num in completed_rides.paginator.page_range %}
            {% if completed_rides.number == num %}
                <span class="page-link current">{{ num }}</span>
            {% elif num > completed_rides.number|add:'-3' and num < completed_rides.number|add:'3' %}
                <button class="page-link" data-page="{{ num }}" data-action="completed">{{ num }}</button>
            {% endif %}
        {% endfor %}
    </div>
    
    {% if completed_rides.has_next %}
        <button class="page-link" data-page="{{ completed_rides.next_page_number }}" data-action="completed">
            Next <i class="fas fa-chevron-right"></i>
        </button>
    {% endif %}
</div>

<div class="pagination-info">
    Showing {{ completed_rides.start_index }}-{{ completed_rides.end_index }} of {{ completed_rides.paginator.count }} completed rides
</div>
{% endif %}

